---
# SPDX-FileCopyrightText: Â© 2025 Olivier Meunier <olivier@neokraft.net>
#
# SPDX-License-Identifier: AGPL-3.0-only

withMultipartImport:
  requestBody:
    content:
      multipart/form-data:
        schema:
          allOf:
            - $ref: "#components/schemas/baseImport"
            - properties:
                data:
                  type: string
                  format: binary
                  description: Import file

routes:
  /bookmarks/import/browser:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"
        - "#.withMultipartImport"

      summary: Import Browser Bookmarks
      description: |
        This route creates bookmarks from an HTML file generated by an export of a browser's
        bookmarks.

  /bookmarks/import/csv:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"
        - "#.withMultipartImport"


      summary: Import CSV files
      description: |
        This route creates bookmarks from a CSV file. Compatible with Instapaper.

        The uploaded file must contain a first row with the column names. Column names are case insensitive and, except for url, every column is optional.

        Here are the columns you can set:

        | Field                    | Alias          | Description
        | ------------------------ | :------------- | :----------
        | `url` (**required**)     |                | Link address
        | `title`                  |                | Bookmark title
        | `state`                  | `folder`       | Bookmark's archived state; only valid value is "archive"
        | `created`                | `timestamp`    | Creation date, can be a UNIX timestamp or an RFC-3339 formatted date
        | `labels`                 | `tags`         | A JSON encoded list of labels

        Example:

        ```
        url,title,state,created,labels
        https://www.the-reframe.com/all-in-the-same-boat/,"All In The Same Boat",,2025-01-12T10:45:56,"[""label 1"",""label 2""]"
        ```

  /bookmarks/import/goodlinks:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"
        - "#.withMultipartImport"

      summary: Import GoodLinks files.
      description: |
        This route creates bookmarks from a GoodLinks export file.

  /bookmarks/import/linkwarden:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"
        - "#.withMultipartImport"

      summary: Import Linkwarden files.
      description: |
        This route creates bookmarks from a Linkwarden export file.

  /bookmarks/import/pocket-file:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"
        - "#.withMultipartImport"

      summary: Import Pocket Saves
      description: |
        This route creates bookmarks from an HTML file generated by Pocket export tool.
        Go to [https://getpocket.com/export](https://getpocket.com/export) to generate
        such a file.

  /bookmarks/import/readwise:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"
        - "#.withMultipartImport"

      summary: Import Readwise files.
      description: |
        This route creates bookmarks from a Readwise export file (CSV).

  /bookmarks/import/text:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"
        - "#.withMultipartImport"

      summary: Import a Text File
      description: |
        This route creates bookmarks from a text file that contains one URL
        per line.

  /bookmarks/import/wallabag:
    post:
      tags: [bookmark import]
      $merge:
        - "traits.yaml#.authenticated"
        - "traits.yaml#.validator"
        - "traits.yaml#.deferred"

      summary: Import Wallabag Articles
      description: |
        This route imports articles from Wallabag using its API.

        You must create an API client in Wallabag and use its "Client ID" and "Client Secret"
        in this route's payload.

      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/wallabagImport"
